/*
 * Boxer [Formstone Library]
 * @author Ben Plum
 * @version 1.6.3
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(e){function s(n){t.formatter=h;return e(this).on("click.boxer",e.extend({},t,n||{}),o)}function o(t){t.preventDefault();t.stopPropagation();var r=e(this),s=t.data.$object,o=r.attr("href")||"",u=o.toLowerCase().split("."),h=u[u.length-1],p=r.data("type")||"";var w=p=="image"||h=="jpeg"||h=="jpg"||h=="gif"||h=="png",E=p=="url"||!w&&o.substr(0,4)=="http",S=p=="element"||!w&&!E&&e(o).length>0,x=typeof s!=="undefined";if(e("#boxer").length<1&&(w||E||S||x)){n={$target:r,$object:s,gallery:{active:false},options:t.data,type:w?"image":"element"};if(w){var T=n.$target.attr("rel");if(typeof T!=="undefined"&&T!==false){n.gallery.active=true;n.gallery.rel=T;n.gallery.$items=e("a[rel= "+n.gallery.rel+"]");n.gallery.index=n.gallery.$items.index(n.$target);n.gallery.total=n.gallery.$items.length-1}var T=n.$target.attr("data-rel");if(typeof T!=="undefined"&&T!==false){n.gallery.active=true;n.gallery.rel=T;n.gallery.$items=e("a[data-rel= "+n.gallery.rel+"]");n.gallery.index=n.gallery.$items.index(n.$target);n.gallery.total=n.gallery.$items.length-1}}var N='<div id="boxer-overlay" class="'+n.options.customClass+'" style="opacity: 0"></div>';N+='<div id="boxer" class="'+n.options.customClass;if(E){N+=" iframe"}if(S){N+=" inline"}N+='" style="opacity: 0;';if(n.options.fixed===true){N+=" position: fixed;"}N+='">';N+='<span class="boxer-close">Close</span>';N+='<div class="boxer-container" style="opacity: 0; height: '+n.options.height+"px; width: "+n.options.width+'px">';N+='<div class="boxer-content">';if(w){N+='<div class="boxer-meta">';if(n.gallery.active){N+='<p class="boxer-position"';if(n.gallery.total<1){N+=' style="display: none;"'}N+=">";N+='<span class="current">'+(n.gallery.index+1)+'</span> of <span class="total">'+(n.gallery.total+1)+"</span>";N+="</p>";N+='<div class="boxer-arrow previous">Previous</div>';N+='<div class="boxer-arrow next">Next</div>';N+='<div class="boxer-caption gallery">'}else{N+='<div class="boxer-caption">'}N+=n.options.formatter.apply(e("body"),[n.$target]);N+="</div></div>"}N+="</div></div></div>";e("body").append(N);n.$overlay=e("#boxer-overlay");n.$boxer=e("#boxer");n.$container=n.$boxer.find(".boxer-container");n.$content=n.$boxer.find(".boxer-content");n.$meta=n.$boxer.find(".boxer-meta");n.$position=n.$boxer.find(".boxer-position");n.$caption=n.$boxer.find(".boxer-caption");n.$arrows=n.$boxer.find(".boxer-arrow");n.$animatables=e("#boxer-overlay, #boxer");n.padding=parseInt(n.$boxer.css("paddingTop"),10)*2;l();if(n.gallery.active){v()}e(window).on("resize.boxer",f).on("keydown.boxer",m);e("body").on("click.boxer","#boxer-overlay, #boxer .boxer-close",a);if(n.gallery.active){n.$boxer.on("click.boxer",".boxer-arrow",d)}if(E||S||x){n.$boxer.on("resize.boxer",i.resize).on("close.boxer",a)}n.$overlay.stop().animate({opacity:n.options.opacity},n.options.duration);n.$boxer.stop().animate({opacity:1},n.options.duration,function(){if(w){c(o)}else if(E){y(o)}else if(S){g(o)}else if(x){b(n.$object)}else{e.error("BOXER: '"+o+"' is not valid.")}})}if(x){return n.$boxer}}function u(){var t=(e(window).width()-n.contentWidth-n.padding)/2;var r=n.options.top<=0?(e(window).height()-n.contentHeight-n.padding)/2:n.options.top;if(n.options.fixed!==true){r+=e(window).scrollTop()}var i=n.$arrows.outerHeight();n.$arrows.css({marginTop:(n.contentHeight-n.metaHeight-i)/2});n.$boxer.stop().animate({left:t,top:r},n.options.duration);n.$container.show().stop().animate({height:n.contentHeight,width:n.contentWidth},n.options.duration,function(e){n.$container.stop().animate({opacity:1},n.options.duration);n.$boxer.find(".boxer-close").stop().animate({opacity:1},n.options.duration);n.options.callback.apply(n.$boxer)})}function a(t){t.preventDefault();t.stopPropagation();if(typeof n.$animatables!=="undefined"){n.$animatables.stop().animate({opacity:0},n.options.duration,function(){e(this).remove()});clearTimeout(r);r=null;e(window).off(".boxer");e("body").off(".boxer");if(n.gallery.active){n.$boxer.off(".boxer")}n={}}}function f(){if(r!==null){clearTimeout(r);r=null}r=setTimeout(function(){l()},10)}function l(){var t=(e(window).width()-n.$boxer.width()-n.padding)/2;var r=n.options.top<=0?(e(window).height()-n.$boxer.height()-n.padding)/2:n.options.top;if(n.options.fixed!==true){r+=e(window).scrollTop()}n.$boxer.css({left:t,top:r})}function c(t){n.$image=e("<img />");n.$image.one("load.boxer",function(){n.originalHeight=n.$image[0].height;n.originalWidth=n.$image[0].width;if(n.options.retina){n.originalHeight/=2;n.originalWidth/=2}n.$content.prepend(n.$image);if(n.$caption.html()==""){n.$caption.hide()}else{n.$caption.show()}if(p(0)){u()}}).attr("src",t).addClass("boxer-image");if(n.$image[0].complete){n.$image.trigger("load")}}function h(e){var t=e.attr("title");return t!=""&&t!==undefined?'<p class="caption">'+t+"</p>":""}function p(t){var r=t==0?n.originalHeight:n.$image.outerHeight();var i=t==0?n.originalWidth:n.$image.outerWidth();var s=t==0?0:n.metaHeight;var o=e(window).width()-n.options.margin-n.padding;var u=e(window).height()-n.options.margin-n.padding-s;if(r<n.options.minHeight){n.options.minHeight=r}if(i<n.options.minWidth){n.options.minWidth=i}var a=i;var f=r;var l;if(i>r){l=r/i;a=o;f=a*l;if(f>u){l=i/r;f=u;a=f*l}}else{l=i/r;f=u;a=f*l;if(a>o){l=r/i;a=o;f=a*l}}if(a>i||f>r){a=i;f=r}if(a<n.options.minWidth||f<n.options.minHeight){if(i<r){l=r/i;a=n.options.minWidth;f=a*l}else{l=i/r;f=n.options.minHeight;a=f*l}}n.$content.css({width:a});n.$meta.css({width:a});n.$image.css({height:f,width:a});n.metaHeight=n.$meta.outerHeight(true);n.contentWidth=a;n.contentHeight=f+n.metaHeight;if(n.contentHeight>u&&t<2){return p(t+1)}return true}function d(t){t.preventDefault();t.stopPropagation();var r=e(this);if(!r.hasClass("disabled")){n.gallery.index+=r.hasClass("next")?1:-1;if(n.gallery.index>n.gallery.total){n.gallery.index=n.gallery.total}if(n.gallery.index<0){n.gallery.index=0}n.$container.stop().animate({opacity:0},n.options.duration,function(){n.$image.remove();n.$target=n.gallery.$items.eq(n.gallery.index);n.$caption.html(n.options.formatter.apply(e("body"),[n.$target]));n.$position.find(".current").html(n.gallery.index+1);c(n.$target.attr("href"));v()})}}function v(){n.$arrows.removeClass("disabled");if(n.gallery.index==0){n.$arrows.filter(".previous").addClass("disabled")}if(n.gallery.index==n.gallery.total){n.$arrows.filter(".next").addClass("disabled")}}function m(e){if(n.gallery.active&&(e.keyCode==37||e.keyCode==39)){e.preventDefault();e.stopPropagation();n.$arrows.filter(e.keyCode==37?".previous":".next").trigger("click")}else if(e.keyCode==27){n.$boxer.find(".boxer-close").trigger("click")}}function g(t){var n=e(t).find(">:first-child").clone();b(n)}function y(t){var n=e('<iframe class="boxer-iframe" src="'+t+'" />');b(n)}function b(e){n.$content.append(e);w(e);u()}function w(r){var i=r.outerHeight(true),s=r.outerWidth(true),o=e(window).height()-n.options.margin-n.padding,u=e(window).width()-n.options.margin-n.padding,a=n.$target.data("height"),f=n.$target.data("width"),l=o<0?t.minHeight:o,c=r.is("iframe");n.contentHeight=a!=undefined?a:c?o:i;n.contentWidth=f!=undefined?f:c?u:s;if(n.contentHeight>l){n.contentHeight=l;if(!c){n.$content.css({overflowY:"scroll"})}}else{n.$content.css({overflowY:"auto"})}n.$content.css({height:n.contentHeight,width:n.contentWidth})}var t={callback:function(){},customClass:"",duration:250,fixed:false,formatter:function(){},height:100,margin:100,minHeight:200,minWidth:200,opacity:.75,retina:false,top:0,width:100};var n={};var r=null;var i={destroy:function(){a(e.Event("click"));return e(this).off(".boxer")},resize:function(e,t,r){if(typeof n.$boxer!="undefined"){if(n.type=="element"){w(n.$content.find(">:first-child"))}u()}}};e.fn.boxer=function(e){if(i[e]){return i[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return s.apply(this,arguments)}return this};e.boxer=function(n,r){return o(e.Event("click",{data:e.extend({$object:n},t,r||{})}))}})(jQuery)